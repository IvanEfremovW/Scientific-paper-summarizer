# Long document summarization with Chain of Density prompting

[English](README.md) | [–†—É—Å—Å–∫–∏–π](README_RU.md)

[![Python](https://img.shields.io/badge/Python-3.11-blue?logo=python)](https://python.org)
[![LangChain](https://img.shields.io/badge/Langcahin-00a67e?logo=langchain)](https://langchain.com)
[![HuggingFace](https://img.shields.io/badge/Hugging%20Face-yellow?logo=huggingface&logoColor=white)](https://huggingface.co/)
[![Gradio](https://img.shields.io/badge/Gradio-white?logo=gradio)](https://www.gradio.app/)

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏–µ—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫—Ä–∞—Ç–∫–æ–π –∏ —Ç–æ—á–Ω–æ–π –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–∑—ã–∫–æ–≤—É—é –º–æ–¥–µ–ª—å **Phi-3-mini-128k-instruct** –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ **Map-Reduce + Chain-of-Density** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ª—é–±–æ–π –¥–ª–∏–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏.

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–¢–æ—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥:**
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **PyMuPDF** –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ —Å–ª–æ–∂–Ω—ã—Ö –º–∞–∫–µ—Ç–æ–≤ (–º–Ω–æ–≥–æ—Å—Ç–æ–ª–±—Ü–æ–≤—ã–π, –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π).

- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é Map-Reduce:**
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –ª—é–±–æ–π –¥–ª–∏–Ω–Ω—ã, —Ä–∞–∑–±–∏–≤–∞—è —Ç–µ–∫—Å—Ç –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã, —Å–æ–∑–¥–∞–≤–∞—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é –∫–∞–∂–¥–æ–≥–æ –∏–∑ –Ω–∏—Ö, –ø–æ—Å–ª–µ —á–µ–≥–æ –æ–±—ä–µ–¥–∏–Ω—è—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –µ–¥–∏–Ω—É—é —Å–≤—è–∑–Ω—É—é –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é.

- **–ü–æ–≤—ã—à–µ–Ω–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–∞ —Å—á—ë—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Chain-of-Density (CoD) –ø—Ä–æ–º—Ç–∏–Ω–≥–∞:**
    –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ —Å–∂–∏–º–∞–µ—Ç —Ä–µ–∑—é–º–µ, —á—Ç–æ–±—ã –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —É–¥–∞–ª—è—è –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –∏ –ø–æ–≤—ã—Å–∏—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Ç–æ—á–Ω–æ—Å—Ç—å.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```Text
Long-document-CoD-summarizer/
‚îú‚îÄ‚îÄ src/
|   ‚îî‚îÄ‚îÄ summarizer/
‚îÇ       ‚îú‚îÄ‚îÄ app.py              # Gradio UI
‚îÇ       ‚îú‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏
‚îÇ       ‚îú‚îÄ‚îÄ ingestion.py        # –ü–∞—Ä—Å–∏–Ω–≥ –¥–æ–∫—É–º–µ–Ω—Ç–∞
‚îÇ       ‚îî‚îÄ‚îÄ summarizer.py       # –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã LLM
‚îú‚îÄ‚îÄ tests/                  
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ .env.example                # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ .env –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ pyproject.toml          
‚îî‚îÄ‚îÄ requirements.txt        
```

## üöÄ Getting started

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
https://github.com/IvanEfremovW/Long-document-CoD-summarizer.git
cd Long-document-CoD-summarizer
```

### 2.1 –ó–∞–ø—É—Å–∫ —Å Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
```bash
docker build -t Long-document-CoD-summarizer .
```
#### –ó–∞–ø—É—Å–∫ –Ω–∞ GPU
```bash
docker run -it --rm --gpus all -p 7860:7860 Long-document-CoD-summarizer
```
#### –ó–∞–ø—É—Å–∫ –Ω–∞ CPU (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∞)
```bash
docker run -it --rm -p 7860:7860 Long-document-CoD-summarizer
```

### 2.2 –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ –∑–∞–ø—É—Å–∫ –±–µ–∑ Docker
>‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è Python 3.10+, CUDA 12.1 –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –≤–µ—Ä—Å–∏—è PyTorch –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞ GPU. 
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ app.py
python -m src.summarizer.app
```

### 3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
üëâ http://127.0.0.1:7860

–í—ã —É–≤–∏–¥–∏—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Gradio:

1. –ù–∞–∂–º–∏—Ç–µ ‚ÄúChoose File‚Äù
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
